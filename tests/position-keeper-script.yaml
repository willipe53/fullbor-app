# Position Keeper API Test Script
# Tests the new start/stop endpoints functionality
# Run with: ./comprehensive-api-test.py position-keeper-script.yaml
# (Authentication and base URL are enabled by default)

defaults:
  headers:
    Content-Type: "application/json"
  timeout: 30

tests:
  # === POSITION KEEPER START/STOP TESTS ===

  # Step 1: Start the position keeper
  - name: "Start position keeper (first attempt)"
    request:
      method: POST
      url: "/position-keeper/start"
    expect:
      status: 201
      json:
        - path: "message"
          exists: true

  # Step 2: Try to start again (should handle gracefully)
  - name: "Start position keeper again (should handle gracefully)"
    request:
      method: POST
      url: "/position-keeper/start"
    expect:
      status: 201
      json:
        - path: "message"
          exists: true

  # Step 3: Stop the position keeper
  - name: "Stop position keeper"
    request:
      method: POST
      url: "/position-keeper/stop"
    expect:
      status: 201
      json:
        - path: "message"
          exists: true

  # Step 4: Start again (should work)
  - name: "Start position keeper again (should work)"
    request:
      method: POST
      url: "/position-keeper/start"
    expect:
      status: 201
      json:
        - path: "message"
          exists: true

  # Step 5: Stop again (should work)
  - name: "Stop position keeper again (should work)"
    request:
      method: POST
      url: "/position-keeper/stop"
    expect:
      status: 201
      json:
        - path: "message"
          exists: true

  # Clean up: Final stop
  - name: "Final cleanup - Stop position keeper"
    request:
      method: POST
      url: "/position-keeper/stop"
    expect:
      status: 201
      json:
        - path: "message"
          exists: true
